{% extends 'includes/base_cadastros.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block content %}

<!-- MENSAGENS DE SUCESSO / ERRO -->
{% if messages %}
  <div class="mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Fechar"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}

<!-- CONTAINER PRINCIPAL -->
<div class="container mt-5">

  <!-- CABEÇALHO DA PÁGINA -->
  <div class="d-flex justify-content-between align-items-center mb-4 p-3 bg-light rounded shadow-sm">
    <a href="{% url 'clientes:lista_clientes' %}">
      <h1 class="display-5 fw-bold text-primary">Lista de Clientes</h1>
    </a>
    <button class="btn btn-success" onclick="abrirModal('{% url 'clientes:novo_cliente' %}', 'Novo Cliente')">
      <i class="fas fa-user-plus me-1"></i> Novo Cliente
    </button>
  </div>

  <!-- FORMULÁRIO DE BUSCA POR NOME E CPF -->
  <form method="get" action="{% url 'clientes:lista_clientes' %}" class="mb-4">
    <div class="input-group">
      <!-- Campo de Busca por Nome -->
      <input type="text" name="nome" value="{{ request.GET.nome }}" class="form-control" placeholder="Buscar por nome">
      
      <!-- Campo de Busca por CPF -->
      <input type="text" name="cpf" value="{{ request.GET.cpf }}" class="form-control" placeholder="Buscar por CPF">
      
      <button class="btn btn-primary" type="submit">
        <i class="fas fa-search"></i> Buscar
      </button>
    </div>
  </form>

  <!-- LISTA DE CLIENTES -->
  <div class="list-group shadow-sm">
    {% for cliente in clientes %}
        <div class="list-group-item d-flex justify-content-between align-items-center mb-3 p-3 rounded-3 border border-1 border-light bg-light">
            <!-- Índice -->
            <div class="d-flex align-items-center">
                <span class="badge bg-primary me-3">{{ forloop.counter }}</span>  <!-- Índice da lista -->
                <div>

                  <h5 class="mb-1">
                    <a href="javascript:void(0);" 
                       class="text-primary fw-bold text-decoration-none"
                       onclick="abrirModalDetalhes('{% url 'clientes:detalhes_cliente' cliente.slug %}')">
                      {{ cliente.nome }}
                    </a>
                  </h5>

                    <p class="mb-1 text-muted">{{ cliente.email }}</p>
                    <p class="mb-1"><strong>CPF:</strong> {{ cliente.cpf }}</p>
                   
                </div>
            </div>

            <!-- Ações -->
            <div class="d-flex gap-2">

    <!-- Botão para Ver Detalhes -->
    <button class="btn btn-sm btn-primary"
        onclick="abrirModalDetalhes('{% url 'clientes:detalhes_cliente' cliente.slug %}')"
        title="Detalhes do Cliente">
        <i class="fas fa-info-circle"></i>
    </button>

    <!-- Botão para Editar -->
    <button class="btn btn-sm btn-outline-warning" 
            onclick="abrirModal('{% url 'clientes:editar_cliente' cliente.slug %}', 'Editar Cliente')" 
            title="Editar Cliente">
        <i class="fas fa-edit me-1"></i> Editar
    </button>

    <!-- Botão para Excluir -->
    <button class="btn btn-sm btn-outline-danger" 
            onclick="abrirModal('{% url 'clientes:excluir_cliente' cliente.slug %}', 'Excluir Cliente')" 
            title="Excluir Cliente">
        <i class="fas fa-trash-alt me-1"></i> Excluir
    </button>

</div>

        </div>
    {% empty %}
        <div class="list-group-item text-center text-muted">Nenhum cliente encontrado.</div>
    {% endfor %}
</div>

<!-- MODAL PRINCIPAL -->
<div class="modal fade" id="clienteModal" tabindex="-1" aria-labelledby="clienteModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="clienteModalLabel">Carregando...</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>
      <div class="modal-body" id="modalBody">
        Carregando...
      </div>
    </div>
  </div>
</div>

{% endblock content %}

{% block extra_scripts %}
<!-- JQUERY -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<!-- BOOTSTRAP JS (essencial para os modais) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- JS AJAX & MODAL -->

{% endblock %}
